(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-34",headers:{authorization:"22f1b2e4-517f-4a72-8a7b-ffa83768ba45","Content-Type":"application/json"}};function t(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function n(n,r,o,a){var i=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0);i.querySelector(".card__image").src=n.link,i.querySelector(".card__image").alt=n.name,i.querySelector(".card__title").textContent=n.name,i.querySelector(".card__like-count").textContent=n.likes.length;var c=i.querySelector(".card__like-button");n.likes.some((function(e){return e._id===o}))&&c.classList.add("card__like-button_is-active"),c.addEventListener("click",(function(){return function(n,r){var o=n.nextElementSibling;n.classList.contains("card__like-button_is-active")?function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:e.headers}).then(t)}(r).then((function(e){o.textContent=e.likes.length,n.classList.remove("card__like-button_is-active")})).catch((function(e){return console.error("Ошибка при снятии лайка:",e)})):function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:e.headers}).then(t)}(r).then((function(e){o.textContent=e.likes.length,n.classList.add("card__like-button_is-active")})).catch((function(e){return console.error("Ошибка при постановке лайка:",e)}))}(c,n._id)}));var u=i.querySelector(".card__delete-button");return n.owner._id!==o?u.style.display="none":u.addEventListener("click",(function(){return a(n._id,i)})),i.querySelector(".card__image").addEventListener("click",(function(){return function(e,t){t(e)}(n,r)})),i}function r(e,t,n){Array.from(e.querySelectorAll(".popup__input")).every((function(e){return e.validity.valid}))?(t.classList.remove(n),t.disabled=!1):(t.classList.add(n),t.disabled=!0)}function o(e,t,n,r){t.validity.valid?function(e,t,n,r){t.classList.remove(n);var o=e.querySelector(".".concat(t.name,"-error"));o&&(o.classList.remove(r),o.textContent="")}(e,t,n,r):function(e,t,n,r){t.classList.add(n);var o=e.querySelector(".".concat(t.name,"-error"));o&&(o.classList.add(r),o.textContent=function(e){return e.validity.valueMissing?e.validationMessage:e.validity.tooShort||e.validity.tooLong?"Длина должна быть от ".concat(e.minLength," до ").concat(e.maxLength," символов."):"link"===e.name&&e.validity.typeMismatch?"Введите корректный URL.":"name"!==e.name&&"place-name"!==e.name&&"description"!==e.name||/^[a-zA-Zа-яА-ЯёЁ\s-]+$/.test(e.value)?"":"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы."}(t))}(e,t,n,r)}function a(e,t){return"name"===t.name||"place-name"===t.name?function(e){var t=e.value.length>=2&&e.value.length<=40,n=/^[a-zA-Zа-яА-ЯёЁ\s-]+$/.test(e.value);return e.validity.valueMissing?e.setCustomValidity(e.validationMessage):t?n?e.setCustomValidity(""):e.setCustomValidity("Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы."):e.setCustomValidity("Длина должна быть от ".concat(e.minLength," до ").concat(e.maxLength," символов.")),e.validity.valid&&t&&n}(t):"description"===t.name?function(e){var t=e.value.length>=2&&e.value.length<=200,n=/^[a-zA-Zа-яА-ЯёЁ\s-]+$/.test(e.value);return e.validity.valueMissing?e.setCustomValidity(e.validationMessage):t?n?e.setCustomValidity(""):e.setCustomValidity("Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы."):e.setCustomValidity("Длина должна быть от ".concat(e.minLength," до ").concat(e.maxLength," символов.")),e.validity.valid&&t&&n}(t):"link"===t.name?function(e){var t=/^(https?:\/\/)?([a-z0-9-]+\.)+[a-z]{2,}(:\d+)?(\/\S*)?$/i.test(e.value);return e.validity.valueMissing?e.setCustomValidity(e.validationMessage):t?e.setCustomValidity(""):e.setCustomValidity("Введите корректный URL."),e.validity.valid&&t}(t):t.validity.valid}function i(e,t){if(t&&t.inputErrorClass&&t.errorClass){var n=t.inputErrorClass,r=t.errorClass;Array.from(e.querySelectorAll(".popup__input")).forEach((function(e){e.classList.remove(n)})),Array.from(e.querySelectorAll(".".concat(r))).forEach((function(e){e.textContent=""}))}}function c(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",l),e.addEventListener("click",s)}function u(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",l),e.removeEventListener("click",s)}function l(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");if(t){var n=t.querySelector(".popup__form");n&&(i(n),n.reset()),u(t)}}}function s(e){if(e.target.classList.contains("popup")){var t=e.target.querySelector(".popup__form");t&&(i(t),t.reset()),u(e.target)}}var d=document.querySelector(".places__list"),p=document.querySelector(".profile__edit-button"),m=document.querySelector(".profile__add-button"),f=document.querySelector(".profile__image"),v=document.querySelector(".profile__title"),y=document.querySelector(".profile__description"),_=document.querySelectorAll(".popup__close"),h=document.querySelector(".popup_type_edit .popup__form"),S=document.querySelector(".popup_type_new-card .popup__form"),q=document.querySelector(".popup_type_edit-avatar .popup__form"),b=document.querySelector(".popup_type_edit"),C=document.querySelector(".popup_type_new-card"),L=document.querySelector(".popup_type_edit-avatar"),g=document.querySelector(".popup_type_image"),E=document.querySelector(".popup_type_confirm-delete"),k=g.querySelector(".popup__image"),A=g.querySelector(".popup__caption"),x=q.querySelector('input[name="avatar"]'),U=null;function V(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить";t?(e.textContent="Сохранение...",e.disabled=!0):(e.textContent=n,e.disabled=!1)}function B(e){k.src=e.link,k.alt=e.name,A.textContent=e.name,c(g)}function M(e){var t=e.querySelector(j.submitButtonSelector);Array.from(e.querySelectorAll(j.inputSelector)).every((function(e){return e.validity.valid}))?(t.classList.remove(j.inactiveButtonClass),t.disabled=!1):(t.classList.add(j.inactiveButtonClass),t.disabled=!0)}function D(n,r){c(E);var o=E.querySelector(".popup__form");o.querySelector(".popup__button").focus(),o.onsubmit=function(o){o.preventDefault(),function(n){return fetch("".concat(e.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:e.headers}).then(t)}(n).then((function(){r.remove(),u(E)})).catch((function(e){console.error("Ошибка при удалении карточки:",e)}))}}f.addEventListener("click",(function(){i(q,j),M(q),c(L)})),q.addEventListener("submit",(function(n){n.preventDefault();var r,o=q.querySelector(j.submitButtonSelector);V(o,!0),(r=x.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:r})}).then(t)).then((function(e){f.style.backgroundImage="url(".concat(e.avatar,")"),u(L)})).catch((function(e){console.error("Ошибка при обновлении аватара:",e)})).finally((function(){V(o,!1)}))})),fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then(t).then((function(e){v.textContent=e.name,y.textContent=e.about,U=e._id,e.avatar&&(f.style.backgroundImage="url(".concat(e.avatar,")"))})).catch((function(e){console.error("Ошибка при загрузке данных пользователя:",e)})),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then(t).then((function(e){e.forEach((function(e){var t=n(e,B,U,D);d.append(t)}))})).catch((function(e){console.error("Ошибка при загрузке данных карточек:",e)})),p.addEventListener("click",(function(){var e,t;e=b.querySelector('input[name="name"]'),t=b.querySelector('input[name="description"]'),e.value=v.textContent,t.value=y.textContent,i(h,j),M(h),c(b)})),h.addEventListener("input",(function(){M(h),o(h,h.querySelector('input[name="name"]'),j.inputErrorClass,j.errorClass),o(h,h.querySelector('input[name="description"]'),j.inputErrorClass,j.errorClass)})),h.addEventListener("submit",(function(n){n.preventDefault();var r=h.querySelector(j.submitButtonSelector);V(r,!0);var o,a,i=b.querySelector('input[name="name"]'),c=b.querySelector('input[name="description"]');(o=i.value,a=c.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:o,about:a})}).then(t)).then((function(e){v.textContent=e.name,y.textContent=e.about,u(b)})).catch((function(e){console.error("Ошибка при обновлении данных пользователя:",e)})).finally((function(){V(r,!1)}))})),m.addEventListener("click",(function(){var e;(e=S).querySelectorAll(".popup__input").forEach((function(e){e.classList.remove("popup__input_type_error")})),e.querySelectorAll(".error-message").forEach((function(e){e.textContent=""})),i(S,j),M(S),c(C)})),S.addEventListener("input",(function(e){var t=e.target,n=t.closest(".popup__form");M(n),o(n,t,j.inputErrorClass,j.errorClass)})),S.addEventListener("submit",(function(r){r.preventDefault();var o,i,c,l,s=S.querySelector(j.submitButtonSelector);if(V(s,!0),c=S,l=!0,Array.from(c.querySelectorAll(".popup__input")).forEach((function(e){a(0,e)||(l=!1)})),l){var p=C.querySelector('input[name="place-name"]'),m=C.querySelector('input[name="link"]'),f={name:p.value,link:m.value};(o=f.name,i=f.link,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:o,link:i})}).then(t)).then((function(e){var t=n(e,B,U,D);d.prepend(t),S.reset(),M(S),u(C)})).catch((function(e){console.error("Ошибка при добавлении карточки:",e)})).finally((function(){V(s,!1)}))}})),_.forEach((function(e){e.addEventListener("click",(function(){var t=e.closest(".popup"),n=t.querySelector(".popup__form");n&&(i(n,j),n.reset(),M(n)),u(t)}))}));var T,w,z,P,N,O,$,j={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"error-message_visible"};w=(T=j).formSelector,z=T.inputSelector,P=T.submitButtonSelector,N=T.inactiveButtonClass,O=T.inputErrorClass,$=T.errorClass,Array.from(document.querySelectorAll(w)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()}));var t=Array.from(e.querySelectorAll(z)),n=e.querySelector(P);t.forEach((function(t){t.addEventListener("input",(function(){t.setCustomValidity(""),a(0,t),o(e,t,O,$),r(e,n,N)})),t.addEventListener("blur",(function(){a(0,t),o(e,t,O,$),r(e,n,N)}))})),r(e,n,N)}))})();